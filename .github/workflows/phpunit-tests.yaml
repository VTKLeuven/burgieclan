name: PHPUnit Tests

on:
  push:
    branches:
      - release/**
  pull_request:
    branches:
      - "**"

jobs:
  php-unit:
    runs-on: ubuntu-latest # The job runs on the latest version of Ubuntu

    steps:
      - name: Checkout code
        uses: actions/checkout@v2 # Checks out the repository code

      - name: Set up PHP
        uses: shivammathur/setup-php@v2 # Sets up the specified PHP version
        with:
          php-version: "8.1"

      - name: Install dependencies
        run: cd backend && composer install # Installs PHP dependencies

      - name: Backend - Update migrations
        run: cd backend && bin/console doctrine:migrations:migrate

      - name: Run PHPUnit tests
        run: backend/vendor/bin/phpunit backend/tests # Runs PHPUnit tests located in the backend/tests directory

      - name: Block merge if tests fail
        if: failure() # This step runs only if the previous steps failed
        run: exit 1 # Exits with a non-zero status to block the merge if tests fail
